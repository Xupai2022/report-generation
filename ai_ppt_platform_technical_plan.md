AI驱动的本地 PPT 报告生成与编辑实验平台 - 技术规划文档

**概述：**本技术规划文档详细阐述如何构建一个“AI 驱动的本地 PPT 报告生成与编辑实验平台”。该平台采用前后端分离架构：前端使用 React + Tailwind CSS + Shadcn UI 实现双栏界面（左侧 PPT 预览，右侧文本编辑），后端使用 Python 基于本地文件系统（JSON 数据和 PPT 模板）实现报告内容生成、AI 重写、PPT 渲染及审计日志记录等功能。下面分章节介绍系统架构、文件结构、模块职责与数据流、前端组件、后端接口、AI 接口契约、审计与校验策略，以及开发与测试建议。

1. 系统架构图与模块划分（前后端分离）

本系统采用前后端分离的架构，由 React 前端 和 Python 后端 两大部分组成，二者通过 HTTP REST API 交互。架构设计如下：

前端（React + Tailwind + Shadcn UI）：提供用户界面，包括 PPT 内容预览和文本编辑功能。前端通过调用后端 API（如生成、重写、保存等接口）与后端通信，将用户操作（如请求生成报告、局部重写某页内容、保存 PPT 等）发送给后端处理，并接收后端返回的数据或结果文件。

后端（Python）：负责实际的 PPT 内容生成与处理。后端由多个功能模块组成，包括模板加载、数据准备、LLM（大型语言模型）协调器、结果校验、PPT 渲染和审计日志模块等。后端通过 OpenAI 兼容的接口调用 AI 模型完成内容生成或改写，并使用 python-pptx 库来创建和更新 PPT 文档
python-pptx.readthedocs.io
。所有数据均存储在本地文件系统（如 JSON 文件、PPTX 模板、输出的 PPT 文件和日志），不依赖外部数据库。

用户浏览器 <--HTTP--> [ 前端 React 应用 ] <--HTTP API--> [ 后端 Python 服务 ]
 前端组件:                       后端模块:
 - PPT预览面板                    - 模板模块 (加载PPTX模板及描述符)
 - 文本编辑面板                    - 数据准备模块 (读取JSON原始数据, 生成结构化事实数据)
 - “AI重写”交互控件                - LLM协调器 (调用OpenAI兼容API, 生成/重写内容)
 - “保存”按钮                     - 校验模块 (结构/schema验证, 事实校对)
                              - PPT渲染模块 (使用python-pptx填充模板, 生成PPT文件)
                              - 审计日志模块 (记录用户修改行为)


如上所示，前端主要负责展示和交互，后端承担核心数据处理与文件生成。两部分通过清晰的接口契约衔接，用户在前端的操作会触发后端相应模块的工作，最终在前端呈现结果。整个系统模块划分清晰，耦合度低，便于分别开发和调试。

2. 本地文件结构示意与关键样例

后端采用本地文件系统来存储数据、模板和输出结果。下面展示项目主要目录结构和示例文件内容：

project-root/
├── frontend/                # 前端React项目
│   ├── src/                
│   │   ├── components/      # React组件 (PPT预览, 文本编辑等)
│   │   └── App.jsx          # 主应用入口
│   └── public/             # 静态资源
├── backend/                 # 后端Python项目
│   ├── data/                # 原始数据与模板
│   │   ├── inputs/         
│   │   │   └── sample_data.json       # 示例原始输入数据 (JSON)
│   │   └── templates/
│   │       ├── template1.pptx         # PPT模板文件
│   │       └── template1_descriptor.json  # 模板描述符文件 (JSON)
│   ├── outputs/
│   │   ├── reports/        # 生成的PPT报告文件
│   │   │   └── report_2025Q4.pptx
│   │   └── logs/           # 审计日志
│   │       └── audit.log
│   ├── app.py              # Flask/FastAPI 主应用，定义HTTP接口
│   └── modules/            # 各功能模块代码
│       ├── template_loader.py
│       ├── data_prep.py
│       ├── llm_orchestrator.py
│       ├── validator.py    # (结构和事实校验)
│       └── ppt_generator.py


关键样例文件说明：

原始数据样例（JSON）：data/inputs/sample_data.json
这是模拟的输入数据文件，包含报告所需的结构化数据。例如财务报告的数据可能如下：

{
  "report_title": "2025 Q4 销售报告",
  "author": "数据分析部",
  "summary": "本季度业绩实现稳健增长，销售额同比提高了5%。",
  "metrics": {
    "total_revenue": 125.3,
    "year_over_year_growth": "5%",
    "top_product": "旗舰X",
    "units_sold": 50231
  },
  "details": [
    { "region": "北美", "revenue": 45.1, "growth": "3%" },
    { "region": "欧洲", "revenue": 33.8, "growth": "6%" }
  ]
}


上述 JSON 包含报告标题、作者、概要，以及关键指标和详细数据列表。这些数据将由 数据准备模块 转换为 PPT 内容生成所需的结构化事实。

模板描述符样例（JSON）：data/templates/template1_descriptor.json
该文件描述 PPT 模板的结构和内容占位符，用于指导内容生成和映射数据到PPT。示例：

{
  "template_id": "financial_report_v1",
  "template_file": "template1.pptx",
  "slides": [
    {
      "layout": "Title Slide",
      "title_field": "{report_title}",
      "subtitle_field": "作者：{author}"
    },
    {
      "layout": "Title and Content",
      "title": "季度概览",
      "content_fields": ["summary"]
    },
    {
      "layout": "Title and Content",
      "title": "主要指标",
      "content_fields": ["metrics.total_revenue", "metrics.year_over_year_growth"]
    },
    {
      "layout": "Title and Content",
      "title": "区域业绩",
      "content_fields": ["details"]
    }
  ]
}


上例描述符定义了模板所包含的幻灯片顺序、版式(layout)及内容来源。例如，第1页使用模板的“Title Slide”版式，填入report_title作为主标题、author作为副标题；第2页为“季度概览”，使用概述文本；第3页显示主要指标中的总收入和同比增长；第4页为区域业绩列表等。模板模块据此加载 template1.pptx 并识别各页占位符，并指导后续内容生成和填充。

上述文件结构确保所有数据和模板均以文件形式存储在本地，方便调试和维护。同时使用 JSON 描述符明确模板结构，便于扩展不同模板。

3. 模块职责说明与数据流（从原始数据到生成 PPT）

后端由多个模块组成，各司其职，共同完成从原始数据到最终 PPT 的生成流程。下面详细说明各模块的功能以及数据处理流：

模板模块（Template Loader）：负责加载 PPT 模板文件和其描述符。读取指定模板 PPTX 文件以及对应的描述 JSON，解析模板中的版式和占位符信息。例如模板模块会识别出模板中每页的布局类型、文本占位符名称等，用于后续填充
python-pptx.readthedocs.io
。模板模块输出模板结构对象供后续使用。

数据准备模块（Data Prep）：接收原始输入数据（JSON 格式）和模板描述符要求，将原始数据转换为结构化的事实数据。该模块按照模板描述符提取或汇总数据。例如：

根据描述符确定需要哪些数据字段，如报告标题、作者、主要指标等，从 sample_data.json 提取对应值；

对复杂数据进行整理，如将多个指标组合成人类可读的句子，或将明细列表转成表格/要点列表的形式。
数据准备的结果是一个结构化的数据包（例如一个包含所有幻灯片内容要点的 Python 字典），作为生成内容的基础事实输入。

LLM 协调器（LLM Orchestrator）：核心模块，负责与大型语言模型交互，生成每页幻灯片的文本内容。它利用模板模块和数据准备模块提供的信息构建提示词（prompt）或对话消息，将模板要求和事实数据传递给 AI 模型，并获取模型生成的结果。对于报告生成，LLM 协调器可能按照每张幻灯片构建单独的提示，让模型逐页生成内容；或者一次性请求模型生成所有幻灯片内容。为提高可靠性，系统可要求模型输出结构化结果（如 JSON），保证每页内容有明确字段，方便后续解析和校验
medium.com
。LLM 协调器支持 OpenAI 兼容接口调用，可选择传统 prompt 模式或 Chat messages 模式调用模型
platform.openai.com
platform.openai.com
（见第6节）。输出：初步的幻灯片内容（可能是结构化的 JSON，包含每页的标题、要点列表等）。

校验模块（Validation）：对 LLM 生成的内容进行后处理校验，包含结构/schema 校验和事实校验两部分：

结构校验：验证 AI 输出格式是否符合预期的 schema。例如，检查每个幻灯片内容是否包含所需的标题和若干要点，或输出的 JSON 能否通过预定义的 JSON Schema 验证
medium.com
medium.com
。如果发现格式错误，模块可以尝试自动修正格式或标记错误部分（必要时可以返回协调整改）。

事实校验：核对 AI 内容与原始数据之间的一致性。由于模型可能引入虚构/错误信息，需要将生成文本中的关键事实（数字、名称等）与数据准备模块的事实数据比对。例如，如果数据准备提供的总收入是125.3，而生成内容声称“收入为130”，校验模块将检测到不一致。对于检测到的偏差，策略包括：**（a）自动用真实数据替换模型输出中的错误值（在内容轻微调整可行时），（b）**记录警告让人工审查修正，或 （c） 再次提示 LLM 修正事实错误。需要注意，结构校验只能保证输出格式正确，但并不保证内容真实
medium.com
；因此事实校验至关重要，以避免报告中的关键数据错误。

PPT 渲染模块（PPT Generator）：该模块使用 python-pptx 库将最终的文本内容填充到 PPT 模板中，生成可下载的 PPTX 文件
python-pptx.readthedocs.io
。具体过程包括：打开模板 PPTX（通过模板模块提供的路径和结构信息），遍历每张幻灯片的占位符，将校验后的文本内容插入相应文本框或表格。对于要点列表，使用段落或项目符号格式填充；对于可能的表格数据或图表（如果有模板定义），可在此步骤加入相应生成（如通过python-pptx的 chart/table API）。填充完成后保存 PPTX 文件到 outputs/reports/ 目录下，文件名可包含时间戳或报告标题。PPT 渲染模块输出：生成的 PPTX 文件路径；另外，它也可以输出每页幻灯片的图像预览（可选，供前端显示）。

审计日志模块（Audit Logger）：该模块负责记录用户在编辑过程中的手动修改情况。通过与前端协作，审计模块跟踪每张幻灯片内容的来源和修改状态。例如，初始生成的每页内容标记为“AI 生成”，若用户手动编辑了第3页文本，则将第3页标记为“人工修改过”。每次用户触发“AI 重写”操作，日志中也记录该行为（如“第2页内容经 AI 建议重写”）。在用户最终保存报告时，审计模块生成一份日志文件（如audit.log），列出各页幻灯片的修改记录和时间戳。这份日志有助于日后审查 AI 生成内容与人工修改的区别，确保报告生产的可追溯性。

整体数据流： 当用户请求生成报告时，后端模块顺序执行：原始数据 -> (模板加载, 数据准备) -> 结构化事实数据 -> (LLM 协调器调用 AI) -> 生成的PPT文本内容 -> (结构 & 事实校验) -> 校验后的最终内容 -> (PPT渲染) -> PPT文件输出。用户随后可以在前端查看每页幻灯片内容，进行必要的修改或让 AI 局部重写内容（此过程会再次经过 LLM 协调器 -> 校验 -> 渲染模块，只针对单页）。最终，用户点击保存，后端输出最终 PPT 文件并写入审计日志完成流程。

4. 前端组件结构说明（视图与编辑逻辑）

前端应用采用 React 构建，并结合 Tailwind CSS 进行样式布局，使用 Shadcn UI 提供开箱即用的组件库来快速搭建界面
shadcn.io
。界面为双栏布局，包含以下主要组件：

PPT预览面板（左侧栏）：用于分页预览幻灯片。该面板按顺序显示当前报告的所有幻灯片，可垂直滚动列表预览或分页切换显示单页。预览内容可以是每页 PPT 的缩略图图像，或简化的样式化文本显示。为了直观呈现PPT效果，系统可在后台将 PPT 幻灯片渲染为图像供此面板展示（例如，每次内容生成或更新后，由后端输出 PNG/JPEG 图片）。用户可以点击选择不同的幻灯片，当前选中的页面会高亮，并在右侧编辑面板中展示对应文本。

幻灯片文本编辑面板（右侧栏）：显示所选幻灯片的原始生成文本，并提供编辑功能。一页对应一个编辑单元，包括：

原始文本区域：展示该页 AI 生成的文本内容（例如幻灯片标题和要点列表）。可以以只读形式显示原始内容供参考。

可编辑文本区域：允许用户修改幻灯片文本的多行文本框（如 Shadcn UI 的 Textarea 组件
shadcn.io
shadcn.io
）。初始内容填入 AI 提供的文本，用户可在此基础上手动编辑。

“AI 重写”控件：在每页编辑单元附有一个按钮或操作入口，例如“✍️ AI优化建议”。当用户点击该按钮时，会弹出一个对话框让用户输入提示（如“请将本页措辞改得更简洁”），或者直接请求系统根据默认策略优化当前页文本。确认后，前端调用后端 /rewrite 接口，将用户提示或当前页面内容发送给 AI 进行局部重写。UI 交互逻辑：调用后端后，界面应显示加载状态，待 AI 返回新文本后，在文本区域中更新内容，并同步更新左侧 PPT 预览图像，使用户即时看到修改效果。

页面导航/切换：在编辑面板顶部，提供页码切换控件（如 “上一页/下一页” 按钮或下拉页码选择），方便用户浏览并编辑不同幻灯片的内容。切换时，会根据所选页索引更新预览高亮和编辑区域内容。

顶部工具栏/菜单（可能的拓展）：包含全局操作按钮，例如“生成新报告”、“保存全部修改”等。用户首次进入可在此选择使用的数据集或模板（如果有多个选项），然后点击“生成报告”触发 /generate 调用。完成编辑后，点击“保存 PPT”触发 /save 接口，将最终内容写入文件并提供下载。

**前端逻辑概述：**用户打开应用后，通过工具栏选择或上传所需的数据/模板并点击生成，前端调用后端生成初始报告内容。收到响应后，前端获得每页幻灯片文本数据和 PPT 文件路径等，将内容填充到预览和编辑面板。用户浏览各页，在编辑面板修改文本（这些修改在前端本地状态暂存）。当用户点击某页的“AI 重写”时，前端发送当前页内容和用户指令到后端 /rewrite，接收新文本后更新界面显示。整个过程中，Tailwind CSS 保证了双栏布局的自适应和美观，Shadcn UI 提供了例如分页组件、模态对话框、按钮等基础组件，使界面一致且易用。通过这一前端结构，用户可以方便地逐页查看和调整由 AI 生成的报告内容，实时获得 PPT 预览反馈，增强交互体验。

5. 后端模块功能与 API 接口设计

后端提供一系列 RESTful API 接口供前端调用，实现报告的生成、局部改写和保存等功能。主要接口及其功能如下：

POST /generate （生成报告）
**功能：**根据给定的模板和数据生成完整报告内容和 PPT 文件。
**请求：**JSON 包含所需参数，例如：

{
  "template_id": "financial_report_v1",
  "data_file": "sample_data.json",
  "options": { "slides": [1,2,3] } 
}


解释：template_id指定使用的模板（对应描述符和PPTX文件），data_file指定输入数据源（在本地data/inputs/目录的文件名）。options可选，用于传递生成选项（如限定生成某些幻灯片范围，或特殊参数）。
**处理流程：**后端接收请求后，由模板模块加载模板描述，数据准备模块读取并整理数据，然后调用 LLM 协调器与 AI 交互生成内容，经校验模块验证和调整，最后 PPT 渲染模块生成 PPTX 文件，存储于outputs/reports/。
**响应：**成功时返回 JSON，包含生成的幻灯片内容数据和文件信息，例如：

{
  "success": true,
  "slides": [
    { "page": 1, "title": "2025 Q4 销售报告", "content": ["作者：数据分析部"] },
    { "page": 2, "title": "季度概览", "content": ["本季度业绩实现稳健增长，销售额同比提高了5%。"] },
    ...
  ],
  "report_file": "outputs/reports/2025Q4_Report_v1.pptx"
}


其中slides数组提供每页幻灯片的文本内容（供前端编辑面板显示），report_file是生成的PPT路径（前端可用于下载或请求预览）。如果生成失败，返回错误信息和原因。

POST /rewrite （局部 AI 重写某页）
**功能：**根据用户提供的提示，对指定幻灯片内容调用 AI 进行改写，并返回改写后的新内容。
**请求：**JSON 示例：

{
  "page": 2,
  "current_content": "本季度业绩实现稳健增长，销售额同比提高了5%。",
  "instruction": "改写成更简洁的措辞"
}


包含页码page（或其他能标识幻灯片的方法，如唯一ID）、当前内容文本current_content，以及用户提供的改写指令instruction（如果用户未输入具体指令，也可为空，此时系统可采用预设的改写提示如“请优化措辞”）。
**处理流程：**后端接收后，由 LLM 协调器构造一个适合的提示，将用户指令和当前内容一并发送给 AI 模型进行处理（例如系统消息指示“你是一个文案助手，用户提供了当前幻灯片内容和希望，你需要据此改写”，用户消息附上当前文本及要求）。得到模型返回的新表述后，先经校验模块快速检查格式（通常无需复杂结构校验，因为改写应保持原结构，只调整措辞）和事实一致性（确保改写未篡改数值等关键事实），然后更新内存中该页幻灯片的内容数据，并使用 PPT 渲染模块更新 PPTX 文件中对应幻灯片的文本占位符。
**响应：**返回JSON：

{
  "success": true,
  "page": 2,
  "new_content": "本季度业绩稳步提升，销售额同比增长5%。"
}


前端据此更新页面显示的文本，并可重新获取该页的预览图。若改写过程中发生错误（如AI接口错误），则返回success:false和错误信息。

POST /save （保存报告）
**功能：**将当前报告内容保存最终版本，并生成审计日志。
**请求：**可以不需额外参数（如果后端已经维护了当前报告的状态），或者前端也可以附带当前全部幻灯片内容数据用于校验同步。例如：

{
  "slides": [
    { "page": 1, "title": "...", "content": [...] },
    ...
  ]
}


后端会将此内容与自身记录对比，确保一致。
**处理流程：**确保所有最新编辑都已应用到 PPT 文件后，返回保存结果。保存时，审计日志模块会遍历幻灯片修改标记，生成日志文件。
**响应：**若成功，返回保存成功消息以及最终报告文件路径或下载链接，例如：

{ 
  "success": true,
  "message": "Report saved successfully.",
  "report_file": "outputs/reports/2025Q4_Report_v1.pptx",
  "audit_log": "outputs/logs/audit.log"
}


前端接收到后可提示用户“保存成功”，并提供 PPT 下载（如果不是自动保存到用户指定位置）。audit_log路径给出日志文件位置，必要时可供管理员查看。

（可选）GET /preview/<page> （获取幻灯片预览图像）
**功能：**返回指定页码的幻灯片渲染图片。前端在每次内容更新或切换页面时可调用此接口获取最新的幻灯片图像。
**实现：**当 PPT 渲染模块更新 PPTX 后，可以借助第三方库或工具将 PPTX 特定页面转换为图像存储（例如调用 LibreOffice 做转换，或Windows下使用COM接口）。此接口读取已转换的图像文件返回，或动态转换后返回。
**响应：**PPT页的 PNG/JPEG 图像（HTTP 二进制流）。前端拿到该图像后显示在预览面板。

上述 API 基本涵盖主要功能。所有接口遵循 REST 约定，通过标准 HTTP 请求进行通信，数据格式采用 JSON。接口设计注重幂等性和一致性：多次调用/generate可覆盖之前生成的内容，/rewrite只影响指定页，/save确保最终一致保存。通过清晰的接口定义，前端和后端开发可以并行，接口文档提供契约保障双方通信正确无误。

6. AI 调用契约说明（请求/响应结构、Schema 要求）

LLM 协调器与 AI 模型交互时，遵循 OpenAI 接口兼容的调用约定。系统支持两种模式调用大型语言模型：传统的文本 prompt 模式和 Chat 对话消息模式。以下对请求/响应格式及我们针对生成内容的 schema 要求进行说明：

Prompt 模式调用：使用POST /v1/completions接口，发送单一提示字符串让模型完成文本。这适用于使用如 GPT-3（text-davinci-003）这类完成式模型。调用时，LLM 协调器会构建一个完整的 prompt，将模板要求和数据嵌入其中。例如，生成5页幻灯片内容的 prompt 可以是：

请根据以下数据撰写 PPT 报告内容，共5页：
1. 标题页：报告标题和作者。
2. 概览页：一段总结描述。
3. 指标页：包括总收入和同比增长。
4. 区域页：列出北美和欧洲的收入及增长。
数据：
{ ...JSON数据... }
输出格式：严格按页顺序给出，每页以"Slide X:"开头，包含标题和内容要点列表。


请求示例：

{
  "model": "text-davinci-003",
  "prompt": "<上面的长提示字符串>",
  "max_tokens": 1000,
  "temperature": 0.7
}


响应示例：

{
  "id": "cmpl-abc123",
  "choices": [
    { "text": "Slide 1: 标题: 2025 Q4 销售报告\n- 作者：数据分析部\n\nSlide 2: 标题: 季度概览\n- 本季度业绩实现稳健增长... (以下省略)", ... }
  ],
  "usage": {...}
}


响应中choices[0].text即模型生成的完整内容文本。LLM 协调器接收此文本后，需要解析成内部结构，例如根据Slide X:标记拆分为各页内容。由于纯文本格式容易出错，实际系统更倾向使用 Chat 模式结合结构化输出。

Chat 消息模式调用：使用POST /v1/chat/completions接口，发送由多条带角色的消息（system/user/assistant）组成的对话
platform.openai.com
。我们采用GPT-4/GPT-3.5等对话模型时使用此模式。它允许更灵活地设置指令和上下文。LLM 协调器通常会构造：

System 消息：扮演角色和规则，例如：“你是一个报告助手，根据给定数据生成商业报告幻灯片内容。输出必须符合指定JSON格式。” 这里可以附上 JSON schema 或示例，引导模型产出结构化结果。

User 消息：提出具体请求，如提供数据摘要并要求生成多页内容，或者在重写场景下，提供当前幻灯片文本和用户希望，例如：“请重写以下内容使其语气更简洁：<原内容>”。

（Assistant 消息在请求时通常无，仅在连续对话中使用）
请求示例：

{
  "model": "gpt-4",
  "messages": [
    {"role": "system", "content": "你是一个智能助手...（省略指导说明，包括格式要求，如输出JSON schema）"},
    {"role": "user", "content": "数据：<JSON数据>。请按照模板要求生成报告，每页输出JSON对象，包括title和content字段..."}
  ]
}


响应示例：

{
  "id": "chatcmpl-xyz456",
  "choices": [
    { "message": {
          "role": "assistant",
          "content": "{ \"slides\": [ { \"page\":1, \"title\":\"2025 Q4 销售报告\", \"content\":[\"作者：数据分析部\"] }, ... ] }"
        }
    }
  ],
  "usage": { ... }
}


可以看到，assistant的回复content是一个JSON字符串，里面包含slides数组，每个元素对应一页的内容。我们在system消息中提前要求了此JSON格式（或使用OpenAI函数调用能力提供JSON schema约束）。这样使得模型输出结构更加规范，可通过代码直接解析为对象进行后续处理和验证。

Schema 要求与验证：无论使用prompt还是chat模式，我们都追求模型输出遵循预定的内容结构。最佳实践是在提示里明确规定输出格式，如使用JSON Schema保证字段完整性
medium.com
medium.com
。例如，定义每张幻灯片内容的JSON模式必须包含title（字符串）和content（数组形式的段落列表）字段。借助OpenAI函数调用或模板化提示，可以在调用中嵌入schema，使模型尽量产生有效结构。如果模型输出不完全符合预期结构，校验模块将介入（参考第7节）。使用 JSON 结构的好处是程序可以可靠地解析模型结果，不会因模型多输出文字或格式走样而导致解析错误
medium.com
。在我们的实现中，LLM 协调器会对AI返回结果尝试做JSON解析（如果是字符串形式），若失败则视为格式错误，交由校验模块处理。

OpenAI兼容接口设置：由于采用OpenAI兼容API标准，我们也遵循其认证和参数规范。例如在后端代码中通过设置openai.api_key环境变量或配置，指向OpenAI密钥或本地部署的兼容服务URL。HTTP请求包含Authorization: Bearer <API_KEY>头部，content-type为application/json等。我们确保请求内容和返回处理符合OpenAI文档定义，以便将来可无缝切换模型提供方（如OpenAI官方、Azure OpenAI，或本地模拟服务），而无需修改系统其他部分。

总结来说，AI 调用契约确保：请求构造明确上下文与格式要求，响应解析严格按照预期的schema进行。如果使用OpenAI官方GPT模型，会产生类似ChatGPT的高质量内容，同时因为我们规定了结构和使用了Schema验证手段，即使LLM自由生成文本的天性，也能保证输出结果机器可解析且内容完整
medium.com
。这一契约设计对平台可靠生成PPT内容至关重要。

7. 审计与校验策略说明

审计策略： 平台要求清晰记录人工干预，确保生成过程透明可追溯。审计日志模块负责跟踪和记录以下行为：

幻灯片人工编辑：当用户在前端手动修改某页内容时（在编辑文本区域做改动），前端会将该页标记为“已编辑”。可以通过在文本框失去焦点或用户跳转页面时，将编辑状态通知后端，后端在内存中记录该页edited_by_user = true。最终保存时，审计模块对比每页的最终内容和AI最初生成内容，凡文本有改动且标记人工编辑的页，即记录为人工修改页。日志条目包括页码、修改类型（人工）、修改时间。如果需要更详细审计，可记录修改前后的文本版本差异（如简要diff）以供将来审查。

AI 重写操作：当用户点击“AI 重写”按钮，并由后端返回新的改写内容时，也属于一次用户主导的内容变更操作。审计日志记录页码、修改类型（AI rewrite）、时间，以及可选地记录所用的用户指令简述。如：“第2页经过AI重写（指令：简洁措辞）”。虽然这由AI生成，但是在用户指令下进行，故也记录在日志中。

审计日志文件采用文本或JSON格式存储于outputs/logs/audit.log。一个日志文件示例（文本格式）：

[2025-12-10 01:15:30] Slide 2: User edited manually.
[2025-12-10 01:20:45] Slide 3: AI rewritten (instruction: "更正式的语气").
[2025-12-10 01:22:10] Slide 5: User edited manually.


如上所示，每条记录包含时间戳、页标识和修改类型说明。JSON格式则可结构化这些信息，方便程序化读取。审计日志在/save保存时最终输出，以供项目管理员或开发者后续分析 AI 生成内容质量和用户偏好调整的部分。

校验策略： 校验模块在第3节已有介绍，这里强调其策略和与审计的配合：

结构/Schema 校验：采用宽严相济策略。对AI输出结构进行严格验证，必须符合预期JSON schema或模板要求的字段。例如如果某页本应有3条要点，但模型只给了2条，我们可以在日志或前端提示“内容可能缺失”，但不会中断整个流程；而是标记该页内容不完整，允许用户自行补充或再让AI完善。此外使用像JSON Schema的验证工具自动校验输出格式
medium.com
，任何不符之处都写入一个内部校验报告，供审计日志或调试使用。这样保证生成的内容格式上不至于破坏后续PPT填充过程（因为缺字段或格式错都会在此提前发现并处理）。

事实校验：策略上对于数值型和客观事实高度敏感，一旦不符立即纠正；对于文字描述类事实（如结论性的表述是否合理）则以提示为主。具体而言：

对比关键数据：数据准备模块可输出一个包含关键值的字典，例如{"total_revenue":125.3, "growth":"5%", ...}，校验模块扫描每页文本，找到所有数字和百分比，检查是否在这些值集合内或与之相近（考虑格式差异，如125.3可能在文本中出现为125.30或“125.3百万”需要转换比较）。若发现不匹配，如文本里出现了“130”却不在数据里，则将该页标记为事实偏差。我们可以自动替换为正确值125.3（如果能精确定位，例如将“130”替换为“125.3”），并在日志中记录“Slide X: corrected value 130 -> 125.3 based on data”。如果无法安全自动修正（比如AI编造了一个不存在的指标），则保持输出但给出警告提示。

核实逻辑一致：对于非数值的信息（如“旗舰X是最畅销产品”这类陈述），检查原始数据（例如top_product字段）是否支撑。如果不一致（AI可能误选了另一产品名），视作事实错误。这种情形可能不易自动更正，因为需要语言理解，但我们至少可以将该页标记需人工复核。

日志和前端提示：所有校验发现的问题都会记录日志。在审计日志或单独的校验日志中写出，如“Slide 4: Fact check failed for field 'top_product', AI output '产品Y', expected '旗舰X'.” 前端也可在编辑界面对相应页显示⚠️标记，提示用户该页内容有可能不准确。

迭代改进：校验模块若发现重大格式或事实问题，可以选择调用 LLM 协调器让模型重新生成或修正。例如：提供模型一个反馈提示：“上一版输出缺少X或有错误Y，请改正。” 这样在无人干预的情况下尝试得到改进结果。然而此操作需谨慎，以免进入循环。因此首次实现中，可以简单地将问题暴露给用户，由用户选择让 AI 重试或自行编辑。

通过审计日志和校验报告双管齐下，系统实现对 AI 生成内容的可信监督：一方面记录人工参与情况确保透明，另一方面自动校验内容保障质量。最终交付的 PPT 报告既有 AI 高效生成的成分，也经过了规则校验和人工审核的把关，最大程度提高内容准确性和可靠性。

8. 开发建议与初始测试建议

构建该系统涉及前后端多个部分，为确保工程顺利进行，提出以下开发阶段建议和测试要点：

项目拆分与里程碑：建议首先搭建后端基础，再开发前端界面，最后联调。里程碑安排：

后端原型：实现 /generate 接口基础功能——从 JSON 输入生成简单 PPT。可先不接入AI，人工撰写固定模板内容填入ppt，以测试python-pptx流程。这一步验证模板加载、ppt生成保存是否正常。例如先用模板描述符，将sample_data.json里的内容直接填入 PPTX 文本框，生成报告文件。

引入 AI 生成功能：接入 OpenAI API（需准备 API 密钥），在 LLM 协调器中调用 GPT 模型生成内容
python-pptx.readthedocs.io
。初期可以使用少量数据和小模型（如GPT-3.5）调试，确保AI返回格式可被解析。逐步增加提示复杂度，如要求输出JSON，并集成结构校验（使用现成的JSON库来校验）。

实现局部重写：实现 /rewrite 接口逻辑，允许传入段落请求AI改写。可先选定一页文本做试验。观察AI输出风格是否符合预期，调整 system 提示词（例如要求语气等）。

前端界面搭建：使用 Create React App 或 Vite 初始化项目，配置Tailwind CSS。借助Shadcn UI构建双栏布局和基本组件（如Button、Textarea等），使用虚拟数据先行模拟界面交互。例如使用假数据填充幻灯片列表和文本编辑区，模拟“AI重写”按钮点击后替换文本的效果。这阶段确保UI/UX体验良好，包括分页切换、滚动预览等。

前后端联调：连接实际API。前端在生成报告按钮上调用/generate，拿到数据后渲染页面；实现编辑保存状态，在用户点击重写时调用/rewrite，收到新文本后更新状态和界面；实现保存按钮调用/save并处理返回（提示用户下载 PPT 等）。重点测试并处理网络异常或延迟情况（如AI接口响应慢需前端loading）。

完善校验与日志：最后实现校验模块完整逻辑和审计日志记录。在前端提供问题提示展示（例如给有警告的幻灯片内容加红色下划线或警告图标），并验证保存后 audit.log 是否准确记录了各修改。

技术选型和实现细节建议:

后端框架建议使用 FastAPI 或 Flask。FastAPI性能好且自带交互式文档，非常适合定义我们的 /generate, /rewrite, /save 路由和数据模型。对于OpenAI API调用，可使用官方 openai Python库简化实现
francescatabor.com
francescatabor.com
（配置 API Key 等）或者使用模拟接口调用本地模型。确保在调用AI前后，增加异常处理（如超时、配额错误），返回友好错误信息给前端。

前端开发使用 Vite + React 模板来快速启动，并确保引入Tailwind CSS配置。Tailwind可以让我们快速定义双栏宽度（如 class="flex flex-row" 等）和响应式样式。Shadcn UI 的组件需要按照官方指南安装
shadcn.io
并引入，我们可以使用其高级组件如 Card 来包裹每个幻灯片编辑块，Scrollbar/ScrollArea 优化预览滚动，Dialog/Modal 用于弹出用户提示输入窗口等，充分利用这些组件减少造轮子。

PPT 预览图像生成如果初期难以实现，可在开发调试阶段退而求其次：前端暂用纯文本或简单HTML模拟PPT外观（如用大号字显示标题，下面列ul/li表示要点）。这样可以先验证前端逻辑。待核心功能稳固后，再研究集成如 python-pptx + Pillow 来截取幻灯片图，或采用**UNO（LibreOffice SDK）**把PPT转PDF再转PNG的方法。

初始测试建议:

单元测试：针对后端各模块编写简单单元测试。例如：给定已知 JSON 数据，测试 data_prep 输出是否包含期望键值；给定一个人工构造的小 prompt，模拟 openai 接口返回，看 llm_orchestrator 能否正确解析出 slides 结构；对 validator 编写测试，输入一个缺字段的 JSON 看它是否报错等。

集成测试：可以编写一个脚本调用 /generate 后端接口，获取返回的 PPTX 文件并打开检查内容（用python-pptx读取验证文本是否都在相应幻灯片）。也可以自动比对 audit.log 内容，比如模拟一个先生成再调用/rewrite的流程，最后看日志是否记录了 rewrite 操作。

人工测试：运行整个系统，在浏览器打开前端进行人工测试。尤其关注：

多次快速点击“AI重写”是否稳定（前端需防重复提交，后端应考虑并发问题）。

长内容或多页情况的性能，前端渲染是否流畅，后端生成是否有明显延迟。可通过日志记录AI调用耗时，优化提示长度或分批调用来改善体验。

错误处理：测试断网或OpenAI密钥无效的场景，前端是否得到明确错误提示（例如“AI服务调用失败，请检查网络或配置”），系统能否恢复正常。

边缘情况：包括输入数据缺失某些字段时，看系统是否能容错（例如模板需要的某数据没有提供，是否有默认文案或提示）；AI可能返回奇怪格式时（如超长文本或不遵循指示），验证校验模块是否能识别并处理。

开发协同：由于模块分明，团队可并行开发。需制定接口Mock数据以便前后端在对方未完成时自测。例如前端在后端未就绪时，可使用本地假JSON模拟/generate返回来调试UI。后端在AI接口未调通前，可先写死一个示例输出用于测试 PPTX 生成流程。

代码维护和扩展：采用清晰的模块和文件结构，便于后续功能扩展。例如将来可能增加支持多个模板、引入图表或图像生成（如用DALL-E生成配图）等，可在现有结构上新增模块而不破坏既有代码。建议对配置选项（如模板路径、OpenAI API Base URL等）集中管理（如用config.py或环境变量），方便部署时调整。

安全与隐私：本地运行的平台，数据不外传，但如果接入OpenAI，需要注意API返回内容的安全。可选开启OpenAI的内容过滤，或在前端/后端增加敏感词检测，防止生成不当内容出现在报告中。日志中不记录敏感数据，仅记录行为。

初始用户试用反馈：在基本功能跑通后，让实际用户尝试，用他们的反馈来改进交互。例如，也许需要在前端增加“一键应用所有AI改写建议”功能，或者提供内容比对视图高亮 AI 改动处。这些都可以在核心系统稳定后进行。